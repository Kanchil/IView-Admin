<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>demo15</title>
</head>
<body>
<canvas id="canvas" width="800" height="400"></canvas>
<button style="width: 80px; background: red;" onclick="linecolor = 'red   '">export</button>
<button onclick="copyimage();                             ">export</button>
<img src="" id="image_png" width="600" height="300" alt="">
</body>
<script>
  var canvas = document.getElementById('canvas')
  var ctx = canvas.getContext('2d')
  ctx.fillStyle = 'black'
  ctx.fillRect(0, 0, 600, 300)
  var onoff = false
  var oldx = -10
  var oldy = -10
  var linecolor = 'white'
  var linew = 4
  canvas.addEventListener('mousemove', draw, true)
  canvas.addEventListener('mousedown', down, false)
  canvas.addEventListener('mouseup', up, false)
  function down(event) {
    onoff = true
    oldx = event.pageX - 10
    oldy = event.pageY - 10
  }
  function up() {
    onoff = false
  }
  function draw(event) {
    if (onoff == true) {
      var newx = event.pageX - 10
      var newy = event.pageY - 10
      ctx.beginPath()
      ctx.moveTo(oldx, oldy)
      ctx.lineTo(newx, newy)
      ctx.strokeStyle = linecolor
      ctx.lineWidth = linew
      ctx.lineCap = 'round'
      ctx.stroke()
      oldx = newx
      oldy = newy
    }
  }
  function copyimage(event) {
    var img_png_src = canvas.toDataURL('image/png')
    document.getElementById('image_png').src = img_png_src
  }
</script>
</html>
